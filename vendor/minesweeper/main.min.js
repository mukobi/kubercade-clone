function Tile(a,b){this.X=a,this.Y=b,this.bombCount=0,this.isBomb=!1,this.isRevealed=!1,this.isFlagged=!1,this.isGuessed=!1}function newGame(){$("#custDiff").collapse("hide"),getScores(),playing=!0,paused=!0,seconds.innerHTML=time=0,score=maxBombs,makeBoard(),displayBoard();var a=document.getElementById("gameBoard");a.onmouseleave=unpressTiles,a.style.width=18*width+"px",document.getElementById("gameHeader").style.width=18*width+6+"px",document.getElementById("newGame").style.backgroundPosition="0px -40px",document.getElementById("wholeGame").style.width=18*width+6+"px"}function makeBoard(){boardArray=new Array(height);for(var a=0;a<height;a++){boardArray[a]=new Array(width);for(var b=0;b<width;b++)boardArray[a][b]=new Tile(b,a)}}function addBombs(a,b){var c=0;do{var d=Math.floor(Math.random()*height),e=Math.floor(Math.random()*width),f=boardArray[d][e];f.isBomb||a-e===0&&b-d===0||(f.isBomb=!0,c++,exploreNearbyTiles(countBombs,e,d))}while(c<maxBombs)}function displayBoard(){document.getElementById("score").innerHTML=score;for(var a=document.getElementById("gameBoard"),b=[],c=0,d=boardArray.length,e=0;e<d;e++)for(var f=boardArray[e].length,g=0;g<f;g++){var h=boardArray[e][g],i="";h.isRevealed?(i="show"+h.bombCount,c++):h.isGuessed?i="guess":h.isFlagged&&(i="flag"),b.push('<div class="tile '+i+'" x="'+g+'" y="'+e+'""></div>')}a.innerHTML=b.join("");for(var j=document.getElementsByClassName("tile"),k=0;k<j.length;k++)j[k].onmousemove=showpress;c==width*height-maxBombs&&winGame()}function custSize(){var a=document.getElementById("height"),b=document.getElementById("width"),c=document.getElementById("mines");height=a.value=""===a.value||a.value<1?1:parseInt(a.value),width=b.value=""===b.value||b.value<9?9:parseInt(b.value),c.value>a.value*b.value-1&&(c.value=a.value*b.value-1),maxBombs=c.value=""===c.value||c.value<1?1:parseInt(c.value),difficulty=3,newGame()}function expandClick(a){var b=parseInt(a.target.getAttribute("x")),c=parseInt(a.target.getAttribute("y"));if(!isNaN(b||c)&&playing){paused&&(addBombs(b,c),paused=!1);var d=boardArray[c][b];if(!d.isRevealed&&!d.isFlagged){if(d.isBomb)return void gameOver(b,c);findBombs(b,c),displayBoard()}}}function rightMouseClick(a){var b=parseInt(a.target.getAttribute("x")),c=parseInt(a.target.getAttribute("y"));if(!isNaN(b||c)&&playing){paused&&(addBombs(b,c),paused=!1);var d=boardArray[c][b];d.isRevealed||(d.isGuessed?(d.isGuessed=!1,d.isFlagged=!1):d.isFlagged?(d.isGuessed=!0,d.isFlagged=!1,score++):(d.isFlagged=!0,d.isGuessed=!1,score--),displayBoard())}}function doubleClick(a){var b=parseInt(a.target.getAttribute("x")),c=parseInt(a.target.getAttribute("y")),d=boardArray[c][b];if(d.isRevealed){var e=0;e=exploreNearbyTiles(countFlags,b,c),e==d.bombCount&&(exploreNearbyTiles(cleanTiles,b,c)?multiDead(b,c):displayBoard())}}function showpress(a){if(playing){unpressTiles();var b=a.target,c=parseInt(b.getAttribute("x")),d=parseInt(b.getAttribute("y")),e=boardArray[d][c];leftMouse&&rightMouse?(e.isGuessed&&!e.isRevealed?b.classList.add("guessPress"):e.isRevealed||b.classList.add("pressed"),exploreNearbyTiles(pressSquare,c,d)):leftMouse&&!e.isRevealed&&(e.isGuessed?b.classList.add("guessPress"):b.classList.add("pressed"))}}function unpressTiles(){for(var a=document.getElementsByClassName("tile"),b=0;b<a.length;b++)a[b].classList.remove("pressed"),a[b].classList.remove("flagPress"),a[b].classList.remove("guessPress")}function pressSquare(a,b){var c=gameBoard.querySelector('[x="'+a+'"][y="'+b+'"]'),d=boardArray[b][a];d.isRevealed||(d.isGuessed?c.classList.add("guessPress"):c.classList.add("pressed"))}function exploreNearbyTiles(a,b,c){for(var d=0,e=b-1;e<=b+1;e++)for(var f=c-1;f<=c+1;f++)e==b&&f==c||e<0||f<0||e>=width||f>=height||(d+=a(e,f));return d}function countBombs(a,b){boardArray[b][a].bombCount++}function findBombs(a,b){var c=boardArray[b][a];c.isBomb||c.isRevealed||c.isFlagged||(c.isRevealed=!0,0===c.bombCount&&exploreNearbyTiles(findBombs,a,b))}function revealAdjacent(a,b){boardArray[b][a].isFlagged||(boardArray[b][a].isRevealed=!0)}function countFlags(a,b){var c=0;return boardArray[b][a].isFlagged&&c++,c}function cleanTiles(a,b){return boardArray[b][a].isFlagged?0:boardArray[b][a].isBomb?1:(findBombs(a,b),0)}function winGame(){for(var a=width*height,b=0;b<height;++b)for(var c=0;c<width;++c)boardArray[b][c].isRevealed&&a--;if(a!=maxBombs)return void alert("Quit trying to cheat! ;)");playing=!1,paused=!0;for(var d=document.getElementById("gameBoard"),e="",f=boardArray.length,b=0;b<f;b++)for(var g=boardArray[b].length,c=0;c<g;c++){var h=boardArray[b][c],i=h.isRevealed?"show"+h.bombCount:"flag";e+='<div class="tile '+i+'" x="'+c+'" y="'+b+'""></div>'}document.getElementById("score").innerHTML=score=0,document.getElementById("newGame").style.backgroundPosition="-112px -40px",d.innerHTML=e,setTimeout(addScores,500)}function gameOver(a,b){playing=!1,paused=!0;for(var c=document.getElementById("gameBoard"),d="",e=0;e<boardArray.length;e++)for(var f=boardArray[e],g=0;g<f.length;g++){var h=boardArray[e][g],i="";g==a&&e==b?i="killer":h.isRevealed?i="show"+h.bombCount:h.isFlagged&&h.isBomb?i="flag":h.isBomb?i="bomb":h.isFlagged&&(i="badGuess"),d+='<div class="tile '+i+'" x="'+g+'" y="'+e+'""></div>'}c.innerHTML=d,document.getElementById("newGame").style.backgroundPosition="-84px -40px"}function multiDead(a,b){exploreNearbyTiles(revealAdjacent,a,b),playing=!1,paused=!0;for(var c=document.getElementById("gameBoard"),d="",e=0;e<boardArray.length;e++)for(var f=boardArray[e],g=0;g<f.length;g++){var h=boardArray[e][g],i="";Math.abs(g-a)<=1&&Math.abs(e-b)<=1&&boardArray[e][g].isBomb&&!boardArray[e][g].isFlagged?i="killer":h.isRevealed?i="show"+h.bombCount:h.isFlagged&&h.isBomb?i="flag":h.isBomb?i="bomb":h.isFlagged&&(i="badGuess"),d+='<div class="tile '+i+'" x="'+g+'" y="'+e+'""></div>'}c.innerHTML=d,document.getElementById("newGame").style.backgroundPosition="-84px -40px"}function myTimer(){return time>=999?void(seconds.innerHTML=time=999):void(paused||(seconds.innerHTML=++time))}function getScores(){$.get("getHighScores.php",function(a){switch(document.getElementById("highScores").innerHTML=a,difficulty){case 0:document.getElementById("diffEasy").style.display="block",document.getElementById("diffMedium").style.display="none",document.getElementById("diffHard").style.display="none";break;case 1:document.getElementById("diffEasy").style.display="none",document.getElementById("diffMedium").style.display="block",document.getElementById("diffHard").style.display="none";break;case 2:document.getElementById("diffEasy").style.display="none",document.getElementById("diffMedium").style.display="none",document.getElementById("diffHard").style.display="block";break;case 3:document.getElementById("diffEasy").style.display="none",document.getElementById("diffMedium").style.display="none",document.getElementById("diffHard").style.display="none"}})}function postScore(a,b,c){$.post("addHighScores.php",{n:a,t:b,d:c}),setTimeout(getScores,500)}function addScores(){var a=0;if(9==height&&9==width&&10==maxBombs)a=0;else if(16==height&&16==width&&40==maxBombs)a=1;else{if(16!=height||30!=width||99!=maxBombs)return;a=2}var b=prompt("Congratulations, you finished in "+time+" seconds!\nEnter your name if you wish to be added to the High score table:");null!==b&&postScore(b,time,a)}var height=16,width=30,maxBombs=99,boardArray,leftMouse=!1,rightMouse=!1,playing,paused,time,difficulty=2,score,seconds=document.getElementById("seconds");setInterval(myTimer,1e3),document.getElementById("newGame").addEventListener("mousedown",function(a){document.getElementById("newGame").style.backgroundPosition="-28px -40px"}),document.getElementById("newGame").addEventListener("mouseup",function(a){newGame()}),document.getElementById("custDiffBtn").onclick=custSize;var gameBoard=document.getElementById("gameBoard");gameBoard.oncontextmenu=function(){return!1},window.addEventListener("load",newGame,!1);var longtouch=!1,touchStart;gameBoard.ontouchstart=function(a){longtouch=!1,touchStart=setTimeout(function(){"vibrate"in navigator&&(navigator.vibrate=navigator.vibrate||navigator.webkitVibrate||navigator.mozVibrate||navigator.msVibrate,navigator.vibrate&&navigator.vibrate([15,15,15])),rightMouseClick(a),longtouch=!0},500)},gameBoard.ontouchend=function(a){if(!longtouch){clearTimeout(touchStart);var b=parseInt(a.target.getAttribute("x")),c=parseInt(a.target.getAttribute("y"));boardArray[c][b].isRevealed?doubleClick(a):expandClick(a)}return longtouch=!1,!1},gameBoard.addEventListener("mousedown",function(a){1==a.which?leftMouse=!0:3==a.which&&(leftMouse||rightMouseClick(a),rightMouse=!0),playing&&(document.getElementById("newGame").style.backgroundPosition="-56px -40px"),showpress(a)}),gameBoard.addEventListener("mouseup",function(a){unpressTiles(),leftMouse&&rightMouse?(leftMouse=!1,rightMouse=!1,doubleClick(a)):leftMouse?(expandClick(a),leftMouse=!1):rightMouse&&(rightMouse=!1),playing&&(document.getElementById("newGame").style.backgroundPosition="0px -40px")});var gameMenu=[{name:"New Game",title:"Start A New Game",fun:function(){newGame()}},{name:"Easy",title:"Easy Difficulty",fun:function(){height=9,width=9,maxBombs=10,difficulty=0,newGame()}},{name:"Medium",title:"Medium Difficulty",fun:function(){height=16,width=16,maxBombs=40,difficulty=1,newGame()}},{name:"Hard",title:"Hard Difficulty",fun:function(){height=16,width=30,maxBombs=99,difficulty=2,newGame()}},{name:"Custom",title:"Not Yet Implemented",disable:!1,fun:function(){$("#custDiff").collapse("show")}}];$("#gameMenu").contextMenu(gameMenu);var helpMenu=[{name:"About",title:"About",fun:function(){}}];$("#helpMenu").contextMenu(helpMenu);